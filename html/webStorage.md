# WebStorage
![](/resource/img/html/webStorage.jpg)<br>
HTML5에서 브라우저의 내부 스토리지를 사용할 수 있도록 제공해주는 기능.<br>
기존 Cookie에 대한 제약을 해소하고 조금 더 다양한 클라이언트으에 많은 기능을 넣고자 생긴 기능.<br><br><br>


## 1. 등장배경.
### 1.1 Cookie의 한계
- 4KB의 데이터 저장 제한
- 쿠키는 매 HTTP 요청에 포함되어 있어 웹이 느려지게 하는 원인이 될 수 있다.
- 같은 쿠키는 도메인 내의 모든 페이지에 같이 전달된다.
- HTTP 요청에 암호화 되지 않고 보내기 때문에 보안에 취약하다.
- 쿠키는 사용자의 로컬에 텍스트로 저장 되어있어 쉽게 접근할 수 있다.


### 1.2 WebStorage의 특징
- 서버로 전달되지 않고 브라우저의 로컬 저장소에 저장된다.
- 저장 용량 chrome 기준 5MB

**사용예**<br>
- 저장소가 필요하지만 다수의 컬럼이 필요한 경우가 아닌 경우.
- 장바구니나 좋아하는 콘텐츠 등 수시로 변경되는 경우
- 방문자의 이동 경로를 저장하였다가 이동할 경우
- 그 외 서버에 반드시 저장할 필요가 없는 경우
- 텍스트입력중 비정상적으로 브라우저가 닫혔을때 자동으로 저장하는 기능.
- '오늘 하루 열지 않기'
- sesstionStorage를 활용해서 사용자가 '입력폼'을 입력하다가 페이지에서 벗어난 경우 백업/복구
- 글쓰기를 하다가 사용자가 창을 벗어난 경우 관련 작성하던 내용 백업/복구용
- 웹서버에 필수적으로 접근해야 하는 캐쉬용(캐쉬로 먼저 서비스 제공, 차후에 업데이트)
- 웹페이지의 개인화 설정들에 대한 저장과 제공(캐쉬로 활용)
- 현재 읽은 글의 히스토리 저장 (카운팅, 읽은글 표시 등으로 활용)
- Canvas나 이미지에 대한 임시 저장 기능(base64로 변환)
- 웹페이지간 정보 전달 (웹서버를 경유하지 않고 정보 로컬에 유지)

<br><br><br>
## 2.종류

###  2.1 Local Storage
- 일부러 지우지 않는다면 브라우저를 닫고 열어도 계속 남아있다.
- 지속적으로 필요한 데이터(자동 로그인 등)


### 2.2 Session Storage
- sessionStorage는 페이지의 window가 바뀌거나 브라우저 탭을 닫을 때 사라진다.
- 잠깐 동안 필요한 정보(일회성 로그인 정보)
<br><br><br>


## 3. WebStorage를 사용전 고려해야할 점
WebStorage를 제공하는 브라우저에서 지켜야 할 사항들.

### 3.1 디스크 용량
1. 브라우저는 악의 적으로 용량을 소모 시키는 사람들이 있을 수 있으므로 스토리지의 최대 용량을 제한해야 하며 한 사이트당 5메가를 권장한다.
2. 사용자는 도메인이 서로 연관된 사이트들이 전체 용량 제한을 피해가기 위해 동작하는 것을 막아야 한다. 
    - (i.g) a1.example.com과 a2.example.com 등의 별도 도메인을 통해서 example.com의 전체 용량 제한을 피해가는 것을 막아야 한다. 
3. 브라우저는 웹 페이지에 대해 추가적인 스토리지를 할당할 수 있는 기능을 제공해야 한다.
4. 브라우저는 각 도메인에서 얼마나 용량을 사용하는지 볼 수 있어야 한다.
5. 용량 산정 기준은 압축이 되지 않은 기준으로 한다.



### 3.2 개인정보
1. 제3의 사이트가 iframe 등으로 다른 도메인에 대한 스토리지를 접근하고자 한다면 이를 막아주어야 한다.
2. 브라우저는 사용자의 설정에 의하여 자동으로 저장된 데이터를 삭제하는 기능이 있어야 한다. 장기간 데이터를 보관하는데 있어서 사용자가 이 부분을 제대로 이해하지 못하면 항상 데이터 삭제에 대한 위험성이 있다.
3. 쿠키처럼 데이터를 삭제하는 기능을 제공하여 사용자가 모든 데이터를 삭제할 수 있는 기능을 제공해야 한다.
4. 보안으로 스토리지 접근을 차단하고 사용자가 선택적으로 이를 허용할 수 있는 기능을 제공해야 한다.
5. 제3의 사이트가 스토리지에 접근하고자 한다면 이를 조회하고 블랙리스트로 차단할 수 있어야 한다.
6. 커뮤니티에서 이러한 사이트들을 공유할 수 있는 기능을 제공해야 한다.
7. 브라우저는 지속되어야 하는 데이터들에 대해서는 민감하게 보관하고 삭제할 때에는 알려주어야 한다.

### 3.3 보안
1. DNS spoofing 공격으로 인하여 현재 도메인에 대해서 보장을 할 수 없기 때문에, 웹페이지들은 TLS를 사용할 것을 권장한다.
2. 같은 도메인에 서로 다른 디렉토리를 사용하는 경우 스토리지를 나눌 수가 없으므로 이러한 특징의 공유 서버에서 서비스를 제공하는 경우 사용을 피할 것을 권장한다. 다른 사이트에서 데이터를 읽어가고 덮어씌우는 것은 아주 쉽게 일어날 수 있다.
3. 제3의 사이트가 스토리지를 접근하고자 하는 것은 사용자 보안을 위해서 막아야 하고, 스토리지를 origin별로 나누는 것에 대해서 철저하게 지켜야 한다. 


### 3.4 개발자 주의사항

블로그 http://blog.naver.com/angel에서 저장된 webStorage는  http://blog.naver.com/devil에서 접근가능하다.<br>
이를 방지하기 위해 같은 도메인을 사용하지만 서로 다른 디렉토리를 사용하는 공유서버 환경에서 webStorage를 사용할 경우에 이런한 접근을 고려하여 민감한 데이터를 저장하지 말아야한다.<br>


## 4. webStorage 이전의 기존 저장소
### 4.1 Cookie
- 저장 가능한 공간의 크기가 가장 작다.
- 하나의 텍스트 형태로 저장되기 때문에 간단한 텍스트 타입의 데이터를 저장하는데 용이하다.  e.i) 팝업 이름을 저장해서 24시간동안 동작하지 않도록하기.

## 4.2 Server Storage
- 데이터의 동기화가 필요하기 때문에 꼭 필요한 경우가 아니면 전송을 최소화하는 것이 좋다.
- 데이터의 크기가 매우 크거나 반드시 저장해야하는 경우에만 사용한다.
- WebStorage는 브라우저의 저장소를 이용하기 때문에 서로 다른 디바이스와 브라우저간에 동일한 기능을 제공해야하는 경우라면 서버 저장소를 사용하는게 옳다.




### 정보 출처
- https://unikys.tistory.com/352