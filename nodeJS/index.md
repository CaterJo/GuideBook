# NodeJs

## intro
Node.js는 Chrome V8 JavaScript 엔진으로 빌드된 JavaScript 런타임입니다.  
즉 자바스크립트를 실행시킬 수 있는 플랫폼입니다.  
Node.js는 이벤트 기반, 논 블로킹 I/O 모델을 사용해 가볍고 효율적입니다. Node.js의 패키지 생태계인 npm은 세계에서 가장 큰 오픈 소스 라이브러리이기도 합니다.  
Node.js는 다양한 목적으로 사용될 수 있는데 가장 많이 사용되는것은 백엔드 서버로서 웹서버의 역할로 가장 많이 사용됩니다.


## 배경
![](../resource/img/nodeJs/howOrganizationsuseNodeJs.png)
왜 node.js를 만들었나?  
자바스크립트르 좀더 다양한 환경에서 사용하기 위해서 탄생.  
자바스크립트는 스트립트 언어이기 때문에 다른 프로그램, 브라우저라는 실행환경에서 동작한다.  
자바스크립트를 브라우저로 부터 독립시켜서 다양한 환경에서 사용하기 위해서 node.js를 만들었다.  
즉, node.js는 새로운 자바스크립트 실행환경이다.


## NodeJs의 4가지 중요 특징
### V8 Engine
브라우저와 Node.js에서 동작하는 자바스크립트는 모두 자바스크립트 엔진 위에서 동작합니다. 구글에서 개발한 V8이라는 자바스크립트 엔진은 빠른속도로 자바스클비트를 해석하고 기계가 인식해서 수행 할 수 있는 코드로 변환하는 역할을 합니다. V8은 독립적으로 실행할 수 있도록 개발되었습니다. Node.js는 자바스크립트를 해석하는 핵심 모듈로 V8을 이용했는데 이 덕분에 최신 자바스크립트 문법과 엔진 성능 향상을 빠르게 자신의 플랫폼에 적용하면서 최신 개발 흐름에 맞춰나가고 있습니다.

### Non-Blcoking I/O

![](/resource/img/nodeJs/whatIsNonBlocking.png)

I/O작업은 요청과 응답을 받기 위한 대기 시간이 오래 걸려 실행 시간에 병목이 생기는 작업입니다. I/O의 처리방법은 Blocking과 Non-Blocking으로 구분할 수 있습니다. 이해를 돕기위해 그림을 준비했습니다. 왼쪽이 Blocking, 오른쪽이 Non-Blocking입니다. 그림에서 보다싶이 모든 요청이 병렬적으로 시작하기 때문에 독립적인 요청일 경우 서로의 요청에 간섭받지 않는다.


### Event-Driven
이벤트에 따라 프로그램 실행을 제어하는 구현 방식을 말합니다. 옵저버가 어떤 이벤트가 발생하는지 관찰하다가 관찰중인 이벤트가 발생했을때 원하는 작업을 실행하는 것을 의미합니다.
![](/resource/img/nodeJs/nodeEventLoop.png)   
Nodejs는 이런 비동기작업을 구현하기 위해 내부적으로 Event Loop를 이용합니다. Event Loop는 Call Stack이 비어있는지 지켜보고 있다가 작업이 모두 실행되어 비어 있는 상태가 되면 이벤트 콜백 목록(Callback Que)에 담긴 콜백을 하나씩 꺼내 작업 목록(Call Stack)으로 가져와 처리합니다.  

Node.js는 대부분의 I/O와 내부 모듈들을 이벤트 형태로 구현해 제공합니다. 덕분에 오래 걸리는 작업 여러가지를 동시에 요청할 수 있습니다. Event Loop와 Non-Blocking I/O덕분에 서버와 같은 프로그램이 수많은 요청을 동시에 요청을 처리할 수 있게 되었고 Single Thread인 Node.js가 고성능 서버로 동작 할 수 있습니다.


### Package Ecosystem
Node.js를 강력하게 만드는 요소중 하나는 Npm(node package manager)입니다. 개발자는 npm을 이용해 자신이 필요한 라이브러리와 패키지를 바로 검색해 설치하고 사용할 수 있습니다. 또한 의존 패키지의 목록과 버전을 하눈에 확인하고 관리할 수 있어서 개발 속도와 효율성을 높이는데 크게 도움이 됩니다.



## 특징
- 구글의 크롬 V8 자바스크립트 엔진을 기반으로한 비동기 IO 를 지원하는 고성능네트워크 서버.
- V8을 이용하여 자바스크립트의 강력함과 단순함을 활용한 이벤트 기반의 논블로킹 I/O를 주 컨셉으로 만든 백엔드(Back-end)  서버.
- 비동기 구조에서 오는 작업 효율성 (Non Blocking IO)
- 클라이언트 언어와 서버 사이드 언어의 통합에서 오는 탁월한 생산성.
- Single Thread 기반이기에 쓰레드간 동기화 처리를 할필요가 없다. (서버 프로그래밍이 단순해진다.)
- Event-Driven 이벤트 기반의 모델링.
- Package Ecosystem 
- 코드를 모듈화하여 재사용하기 수월하다.


##  장점
1. 매우 빠른 고성능 서버
2. 비동기 처리로 인해 퍼포먼스가 증가한다.
    - 적은 응답시간과 높은 동시성.
3. 광범위한 커뮤니티
4.  탁월한 생산성
5. 이벤트 드리븐방식의 이점
    - 대부분의 쓰레드 풀 기반의 웹서버가 사용자가 이벤트를 발생시키는 것을 기다리며 자원을 지속적으로 소비하는 반면 event-driven방식은 데이터가 전송됐을때만 작동하는 방식으로 자원을 최소화한다.
    - 싱글 스레드기때문에 멀티스레드 구조의 웹서버에서 생기는 각각의 스레드의 동시성에 대한 고민을 하지않아도 된다.

## 단점 
1. 에러가 날 경우 서버가 다운된다.
    - 타임아웃이나 예외처리에 대한 로직을 적절히 대응해야한다.(watch dog )
2. 싱글 스레드기반이기에 멀티 코어 머신에서 cpu 사용을 최적화 할 수 없다.(단일 스레드는 하나의 물리적 코어만 사용한다.)
    - 하나의 작업이 지연되면 전체 작업효율에 급격히 떨어진다.
    - CPU를 많이 사용하지 않는 작업 위주로 개발되어야 한다.
3. 코드의 가독성이 좋지않다. 
    - 자바에 비해 자바스크립트는 코드의 가독성이 좋지 않기 때문이다.
    - 코드의 가독성이 좋지 않다보니, 유지보수가 어려워 질 수 있다.
    - 이 부분은 비동기처리에 의한 부분인데 promise와 async/awaite로 보완가능하지만 타 언어에 비해 가독성이 떨어지는건 사실.
    - 타입검사를 위해 Typescript등을 도입할 수 있으나 이 역시 가독성이 떨어지는것 마찬가지다.
4. 실행해봐야 에러를 확인 할 수 있다.
    - 컴파일시 확인이 불가하다.
    - TpyeScript를 사용하면 보완이 가능하다.
5. 프로그래밍 컨셉이 기존의 서버사이드 컨셉과는 달라서 적응 시간이 필요하다. 
    - 멀티 스레드 방식이 아닌 이벤트 드리븐 방식에 적응해야한다.
    - 코드를 순차적으로 실행하는 것이 아니라, 비동기 방식으로 이벤트를 보내 놓고, 그 응답에 대한 이벤트가 오면 핸들러를 통해서 처리하는 형식이기 때문에, 기존 서버 프로그래밍 모델과는 많은 차이가 있다.
6. 멀티코어 활용을 위해서 cluster 모듈을 이용해야 하고, 세션을 공유할 경우 부가적인 작업이 필요함



## Node.js에 적합한 어플리케이션은?
- 입출력이 잦은 어플리케이션
- 데이터 스트리밍 어플리케이션
- 데이터를 실시간으로 다루는 어플리케이션
- JSON API 기반 어플리케이션  
- 싱글페이지 어플리케이션
- CPU 부하가 적고, 많은 커넥션을 동시에 처리해야 하는 구조에 적합.

Node.js의 특징을 살펴보면 짧은 시간에 대량의 클라이언트 요청을 처리하는 웹 어플리케이션을 개발하기엔 적합하나, CPU의 사용이 높게 필요한 어플리케이션의 경우(특히, 하나의 작업처리 시간이 길게 필요한경우)에는 오히려 성능이 좋지 않을 수 있을것 같습니다.
간단히 말하면, Node.js는 간단하지만 많은 양의 처리를 요하는 서버를 구축할때 효율이 좋습니다.


## Node.js를 도입한 기업이 말하는 node.js의 도입효과
1. 생산성 향상
2. 개발비용 절감
3. 퍼포먼스 향상

 

## 수요 및 전망
1. 최근 성장중인 OTT시장과 맞물려 더욱 많은 스트리밍 서비스 증가로 수요가 늘어날것.
    - 넷플릭스
    - 5g
2. 싱글 스레드라는 태생적 한계가 있기때문에 모든 분야에서 사용되긴 어렵다.
3. 제한적 환경에서 이용이 되겟지만 앞으로도 꾸준히 사용될 것으로 전망.




## Ref
- [node.js를 도입하는 이유](https://d2.naver.com/helloworld/4994500)
- [node의 전망](https://d2.naver.com/helloworld/7700312)
- [node.js 소개](http://sblog.netraweb.com/node-js-%EA%B0%95%EC%A2%8C-node-js-%EB%9E%80-%EA%B0%9C%EB%85%90%EA%B3%BC-%EC%86%8C%EA%B0%9C/)
- [about Node.js](https://huni.org/node-js%EC%97%90-%EB%8C%80%ED%95%98%EC%97%AC-48d0a5af438b)
- [Understanding NodeJs](https://programmingsummaries.tistory.com/328?category=604662)